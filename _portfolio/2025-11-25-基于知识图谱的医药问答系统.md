---
title: 基于知识图谱的医药问答系统
subtitle: 融合 Neo4j 图数据库与 AC 自动机算法的智能医疗诊断对话系统
image: assets/img/作品集/基于知识图谱的医药问答系统/基于知识图谱的医药问答系统.gif
alt: 医药问答系统架构图
category: school
featured: true

caption:
  title: 基于知识图谱的医药问答系统
  subtitle: Intelligent Medical QA System
  thumbnail: assets/img/作品集/基于知识图谱的医药问答系统/基于知识图谱的医药问答系统.gif
---

<div class="q-bounce-content" markdown="1">

## 📊 项目信息
- **完成时间**: 2024年11月
- **项目类型**: 算法/后端工程
- **核心技术**: Python, Neo4j, AC自动机, FastAPI, PyQt5
- **开源仓库**: [链接待补充]

## 1. 项目概览

本项目是一个基于知识图谱的医药领域智能问答系统。它利用 **Neo4j** 图数据库存储大规模医药知识，通过 **AC 自动机 (Aho-Corasick automation)** 进行高效的实体识别，并结合规则匹配技术实现自然语言问题的自动解析与精准回答。

系统不仅支持命令行交互，还配备了 PyQt5 图形界面和 FastAPI Web 接口，能够回答关于疾病症状、治疗方法、药品信息、饮食禁忌等多种类型的医疗问题。

## 2. 技术架构

### 2.1 核心技术栈

本项目综合运用了图数据库、算法和现代软件开发框架，主要技术包括：

#### 1. 知识图谱存储：Neo4j
**Neo4j** 是目前业界最流行的原生图数据库。本项目利用 Neo4j 存储构建好的医药知识图谱。
- **应用**：以"节点-关系-节点"的图结构，直观存储疾病、药品、症状、科室等实体及其复杂的关联（如 `感冒` -[推荐药物]-> `感冒灵`）。
- **优势**：在处理复杂的关系查询（如"查询某药品的副作用及其适用人群"）时，比传统关系型数据库快数倍。

#### 2. 核心算法：AC 自动机 (Aho-Corasick)
**AC 自动机** 是一种经典的高效多模式匹配算法。
- **应用**：用于问答系统中的**实体识别 (NER)** 阶段。它能一次性在用户输入的长句中快速扫描出词库中包含的所有医疗实体（如疾病名、药名）。
- **优势**：扫描速度极快，时间复杂度仅与输入文本长度有关，不受词典规模（几十万词条）影响。

#### 3. Web 服务框架：FastAPI
**FastAPI** 是一个现代、高性能的 Python Web 框架。
- **应用**：将问答系统封装为 RESTful API 服务，对外提供 `/chat` 接口。
- **优势**：基于 Python 类型提示，自动生成 Swagger 在线文档，支持异步请求，适合高并发场景。

#### 4. 桌面 GUI 框架：PyQt5
**PyQt5** 是著名的跨平台 GUI 框架 Qt 的 Python 绑定。
- **应用**：开发了独立的桌面客户端，提供像微信一样的聊天窗口体验，方便用户交互。

#### 5. 图数据库驱动：py2neo
- **应用**：作为 Python 与 Neo4j 之间的桥梁，用于执行 Cypher 查询语句（Graph SQL）并将结果转化为 Python 对象。

### 2.2 系统工作流程

1.  **知识存储 (Build Graph)**:
    - 系统读取结构化的 JSON 数据源。
    - 使用 `py2neo` 将数据导入 Neo4j，构建以疾病为中心的知识图谱。

2.  **问题理解 (NLU)**:
    - **实体识别**: 使用 `ahocorasick` 库构建 AC 自动机，从用户输入中提取医疗实体（如“感冒”、“阿司匹林”）。
    - **意图分类**: 基于关键词（如“症状”、“怎么治”）和提取的实体类型，将问题分类（例如 `disease_symptom`, `disease_drug`）。

3.  **查询构建 (Query Generation)**:
    - 系统根据分类结果和实体信息，动态生成 Cypher 查询语句 (Graph SQL)。

4.  **答案检索与生成 (Answer Construction)**:
    - 在 Neo4j 中执行 Cypher 查询。
    - 将图数据库返回的结构化结果转换为自然语言，反馈给用户。

## 3. 核心模块说明

### 3.1 知识图谱构建 (`build_medicalgraph.py`)

脚本负责初始化数据库模式并导入数据。

-   **数据源**: `data/medical.json` (及补充资料)
-   **节点 (Nodes)**:
    -   `Disease` (疾病): 核心节点，包含病因、预防、治愈率等属性。
    -   `Drug` (药品), `Symptom` (症状), `Food` (食物), `Check` (检查), `Department` (科室), `Producer` (厂商)。
-   **关系 (Relationships)**:
    -   `has_symptom` (症状表现)
    -   `need_check` (所需检查)
    -   `recommand_eat` / `no_eat` / `do_eat` (饮食建议)
    -   `common_drug` / `recommand_drug` (用药建议)
    -   `acompany_with` (并发症)

### 3.2 问答流水线 (`chatbot_graph.py`)

这是问答系统的核心控制器，协调以下子模块：

-   **`question_classifier.py`**:
    -   加载 `dict/` 目录下的特征词库。
    -   利用 AC 自动机进行实体链接。
    -   区分 18+ 种问题类型（如 `disease_cause` (病因), `disease_prevent` (预防)）。
-   **`question_parser.py`**:
    -   将分类后的问题转化为结构化的 SQL (Cypher) 查询字典。
-   **`answer_search.py`**:
    -   执行查询并格式化输出。例如，将查询到的多个药品名称拼接成通顺的句子。

### 3.3 服务与接口

-   **CLI (`chatbot_graph.py`)**: 简洁的命令行问答。
-   **GUI (`gui_chatbot.py`)**: 基于 `PyQt5`，提供聊天窗口风格的界面，方便非技术人员测试。
-   **Web API (`server.py`)**: 基于 `FastAPI`，提供 `/chat` 接口，支持 JSON 数据交互，易于集成到前端网页或小程序。

## 4. 项目文件结构

```
QAMedicalKG/
├── chatbot_graph.py          # [入口] 命令行主程序
├── gui_chatbot.py            # [入口] GUI 主程序
├── server.py                 # [入口] Web API 主程序
├── build_medicalgraph.py     # [工具] 图谱构建脚本
├── question_classifier.py    # [核心] 问题分类器 (AC自动机)
├── question_parser.py        # [核心] 语句解析器
├── answer_search.py          # [核心] 答案检索器
├── requirements.txt          # 依赖列表
├── data/                     # 数据源目录
└── dict/                     # 实体特征词典 (自动生成)
```

## 5. 🤕 遇到的挑战与解决方案

### 5.1 知识图谱的冷启动与建模
**挑战**: 初次接触图数据库，如何将非结构化或半结构化的医疗数据高效映射为 Neo4j 的节点与关系（Schema Design）是一个难点，设计不当会导致查询十分低效。
**解决**:
- **可视化辅助学习**: 利用 AI 工具和大模型辅助理解图论概念，快速掌握 Cypher 查询语法。
- **迭代建模**: 通过实战不断调整图谱结构，例如将“副作用”从属性升级为独立节点，以支持反向查询。

### 5.2 高并发下的多模式匹配
**挑战**: 传统的关键词匹配在面对数万个疾病和药品名词时效率极低。
**解决**:
- 引入 **AC 自动机** 算法替换简单的正则匹配，将时间复杂度降低到线性级别，显著提升了实体识别的响应速度。

</div>
---
title: 版本管理助手（Unity插件）
subtitle: 基于 Git CLI 封装的 Unity 编辑器深度集成版本控制工具
image: assets/img/作品集/版本控制助手/版本控制助手宣传图_01.jpg
alt: 版本管理助手插件界面
category: personal
featured: true

caption:
  title: 版本管理助手（Unity插件）
  subtitle: Unity Editor Extension
  thumbnail: assets/img/作品集/版本控制助手/版本控制助手宣传图_01.jpg
---

<div class="q-bounce-content" markdown="1">

## 📊 项目信息
- **完成时间**: 2025年11月
- **项目类型**: Unity 编辑器扩展 (Editor Extension)
- **核心技术**: C#, Unity Editor GUI, System.Diagnostics, Git CLI

## 1. 项目概览
<img src="assets/img/作品集/版本控制助手/版本控制助手宣传图_02.jpg" class="img-fluid d-block mx-auto" alt="版本控制助手宣传图_02">
**Version Control Assistant** 是一个精巧的 Unity 编辑器扩展，旨在为开发者提供丝滑的 Git 版本控制体验。与依赖庞大原生库（如 `libgit2`）的方案不同，本工具采用了**轻量级封装 Git 命令行 (CLI)** 的技术路线，在保证功能完备的同时，完美兼容开发者本地的标准 Git 配置与工作流。

## 2. 技术栈 (Technology Stack)

### 核心技术
*   **开发语言**: C# (Unity .NET Runtime)
*   **运行环境**: Unity Editor (Editor Scripting)
*   **版本控制系统**: Git (System CLI)

### 系统 API
*   **`System.Diagnostics.Process`**: 插件的核心骨架。用于启动外部 Git 进程、执行命令并捕获输出。
*   **`System.IO`**: 用于处理文件路径、验证目录存在性以及读取流。
*   **`System.Text`**: 显式处理 UTF-8 编码，确保在不同语言环境（中文/日文/英文）下字符显示的正确性。

## 3. 架构与实现细节
<img src="assets/img/作品集/版本控制助手/版本控制助手宣传图_04.jpg" class="img-fluid d-block mx-auto" alt="版本控制助手宣传图_04">

本项目采用分层架构，将 UI 表现层与核心 Git 逻辑层分离。

### 3.1 核心逻辑层 (`GitProcessUtility.cs`)
这是一个静态类，充当 Unity 与 Git 可执行文件之间的桥梁。

*   **进程执行策略**:
    *   使用 `ProcessStartInfo` 配置 `RedirectStandardOutput` 和 `RedirectStandardError`，在不弹出命令行窗口的情况下捕获命令结果 (`CreateNoWindow = true`)。
    *   **跨平台支持**: 动态检测 Git 可执行文件（Windows 下查找 `git` 或 `git.exe`，macOS/Linux 下查找 `git`）。
    *   **异步流读取**: 利用 `OutputDataReceived` 和 `ErrorDataReceived` 事件安全地捕获大量输出（如长日志），防止死锁，尽管为了保证编辑器内的数据一致性，主调用通常表现为同步等待。

*   **数据解析策略**:
    *   **状态解析**: 解析 `git status --porcelain` 的输出。这是一个“管道级”命令，提供稳定的、机器可读的格式，不受用户配置或 Git 版本影响，确保了状态追踪（新增、修改、删除、未跟踪、重命名）的健壮性。
    *   **日志解析**: 在 `git log` 中使用自定义的分隔符格式 (例如 `--pretty=format:"%h%x1F%an%x1F%cr%x1F%s"`)。利用单元分隔符 (`\x1F`) 来可靠地分割提交哈希、作者、日期和消息，避免因用户提交信息中包含特殊字符而导致标准正则解析失败的问题。

### 3.2 UI 层 (`VersionControlAssistantWindow.cs` & `GitTreeView.cs`)
*   **框架**: Unity Editor GUI (通过代码绘制的编辑器界面)。
*   **架构设计**:
    *   **树状视图 (Tree View)**: 实现了层级视图逻辑，将变动的文件按文件夹结构分组显示，复刻了 IDE（如 Rider 或 VS Code）的浏览体验。
    *   **本地化 (Localization)**: 自定义的 `GitLocalization` 系统支持 UI 标签和错误信息的动态语言切换（中文/英文/日文）。

## 4. 关键技术特性
<img src="assets/img/作品集/版本控制助手/版本控制助手宣传图_06.jpg" class="img-fluid d-block mx-auto" alt="版本控制助手宣传图_06">

### 健壮的命令处理
工具处理了 CLI 封装中常见的边界情况：
*   **编码处理**: 显式处理 UTF-8，以支持文件路径和提交信息中的非 ASCII 字符。
*   **错误安全**: 分离 `stdout` (标准输出，代表成功) 和 `stderr` (标准错误，代表错误/警告)，确保 Git 的警告信息（通常输出到 stderr）不会导致解析逻辑崩溃。

### 性能优化
*   **懒加载**: 对昂贵的操作（如 `git log`）进行限制（例如默认 `-n 12`），防止阻塞 UI 线程。
*   **后台处理**: (隐含设计) 状态检查通常由特定事件触发，以最小化对 Unity 主线程的性能影响。

## 5. 系统要求

*   **Unity 版本**: 兼容现代 Unity 版本（通过 `manifest.json` 依赖项验证）。
*   **系统依赖**:
    *   **Git**: 必须在宿主操作系统上安装 Git，并确保其已添加到系统环境变量 `PATH` 中。

## 6. 🤕 遇到的挑战与解决方案

### 6.1 Editor GUI 的深度定制限制
**挑战**: Unity 自带的 `EditorGUILayout` 主要用于快速开发调试工具，其默认样式较为简陋，难以满足“原生商业级插件”的美学要求。

**解决**:
*   放弃部分默认布局，使用底层 `GUI.DrawTexture` 与 `EditorStyles` 进行自定义绘制。
*   通过**像素级调整 (Pixel-perfect refinement)** 优化间距、图标对齐与字体渲染，实现了接近 IDE 原生的视觉体验。

### 6.2 跨进程调试的复杂性
**挑战**: 插件核心依赖于外部 Git 进程的调用，当出现异常时（如编码错误或子进程死锁），Unity 编辑器本身的报错信息往往不够直观。

**解决**:
*   构建了健壮的**日志中间层**，将标准错误流 (stderr) 智能映射为 Unity Console 的 Warning/Error。
*   引入了详细的防御性编程检查，确保在环境异常时给出清晰的修复指引（如提示“未找到 Git 环境变量”）。

</div>